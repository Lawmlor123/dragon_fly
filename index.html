<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Little Dragon Flyer üê≤üî•</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: linear-gradient(to bottom, #87ceeb, #dff9fb);
  }
  canvas { display: block; }
  #overlay, #scoreBoard, #winOverlay {
    position: absolute;
    font-family: 'Comic Sans MS', cursive;
    z-index: 10;
  }
  #overlay {
    top: 10px;
    left: 10px;
    font-size: 22px;
    color: #333;
    background: rgba(255,255,255,0.5);
    padding: 6px 12px;
    border-radius: 8px;
  }
  #scoreBoard {
    top: 10px;
    right: 10px;
    font-size: 24px;
    color: #222;
    background: rgba(255,255,255,0.5);
    padding: 6px 14px;
    border-radius: 8px;
  }
  #winOverlay {
    display: none;
    top: 40%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 60px;
    color: #e74c3c;
    background: rgba(255,255,255,0.8);
    padding: 40px 60px;
    border-radius: 20px;
    animation: pop 1s ease infinite alternate;
  }
  @keyframes pop {
    0% { transform: translate(-50%, -50%) scale(1); }
    100% { transform: translate(-50%, -50%) scale(1.05); }
  }
</style>
</head>
<body>
<div id="overlay">üêâ Tap or Press Space to Fly (and breathe BIG fire!)</div>
<div id="scoreBoard">Score: 0</div>
<div id="winOverlay">üéâ YOU WIN! üéâ</div>
<canvas id="gameCanvas"></canvas>

<!-- üéµ Background Music -->
<audio id="bgMusic" src="Music/Chase.mp3" loop preload="auto"></audio>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const scoreBoard = document.getElementById("scoreBoard");
const winOverlay = document.getElementById("winOverlay");

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

// ---- DRAGON ----
let dragon = {
  x: canvas.width * 0.2,
  y: canvas.height / 2,
  radius: 40,
  velocity: 0,
  gravity: 0.25,
  flapStrength: -6
};

// ---- BACKGROUND ELEMENTS ----
let clouds = [];
for (let i = 0; i < 5; i++) {
  clouds.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height*0.5, size: 60+Math.random()*80 });
}

let rocks = [];
const rockColors = ["#e74c3c", "#3498db", "#e74c3c", "#3498db", "#e74c3c"];
const rockHeights = [0.3, 0.45, 0.6, 0.5, 0.7];
const rockPoints = [10, 20, 30, 15, 25];
for (let i=0; i<5; i++){
  rocks.push({
    x: canvas.width + i*(canvas.width/2),
    y: canvas.height*rockHeights[i],
    radius:45,
    color:rockColors[i],
    active:true,
    points:rockPoints[i]
  });
}

// ---- RED 100 POINT BUBBLES ----
let bubbles = [];
for (let i=0; i<3; i++){
  bubbles.push({
    x:canvas.width + Math.random()*canvas.width,
    y:100 + Math.random()*(canvas.height-200),
    radius:35,
    color:"rgba(150,0,0,0.85)",
    active:true,
    points:100
  });
}

// ---- PARTICLES ----
let particles = [];
function createExplosion(x,y,color){
  for (let i=0; i<25; i++){
    particles.push({
      x,y,
      radius:4+Math.random()*4,
      color,
      alpha:1,
      velocityX:(Math.random()-0.5)*6,
      velocityY:(Math.random()-0.5)*6,
      isFire:false
    });
  }
}

// üî• Bigger Fire
function createFire(){
  const sx = dragon.x + dragon.radius * 1.4;
  const sy = dragon.y - 6;
  for (let i=0; i<40; i++){ // increased number
    const colorChoices = ["#ff3300", "#ff9900", "#ffff66", "#ff6600"];
    particles.push({
      x:sx,
      y:sy,
      radius:6 + Math.random()*10, // bigger flames
      color:colorChoices[Math.floor(Math.random()*colorChoices.length)],
      alpha:1,
      velocityX:6 + Math.random()*4, // spreads farther
      velocityY:(Math.random()-0.5)*6,
      isFire:true
    });
  }
}

function drawParticles(){
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i];
    ctx.globalAlpha=p.alpha;
    ctx.fillStyle=p.color;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.radius,0,Math.PI*2);
    ctx.fill();

    if(p.isFire){
      p.x+=p.velocityX;
      p.y+=p.velocityY;
      p.alpha-=0.035;
      p.radius*=0.96;
    } else {
      p.x+=p.velocityX*0.6;
      p.y+=p.velocityY*0.6;
      p.alpha-=0.02;
    }
    if(p.alpha<=0.05) particles.splice(i,1);
  }
  ctx.globalAlpha=1;
}

// ---- SCORE ----
let score=0;
const WIN_SCORE=500;
let gameOver=false;

// ---- DRAW ENVIRONMENT ----
function drawSky(){ ctx.fillStyle="#87ceeb"; ctx.fillRect(0,0,canvas.width,canvas.height); }
function drawClouds(){
  ctx.fillStyle="rgba(255,255,255,0.85)";
  clouds.forEach(c=>{
    ctx.beginPath();
    ctx.ellipse(c.x,c.y,c.size,c.size*0.6,0,0,Math.PI*2);
    ctx.fill();
    c.x-=0.3;
    if(c.x<-c.size){c.x=canvas.width+c.size; c.y=Math.random()*canvas.height*0.5;}
  });
}
function drawGround(){
  ctx.fillStyle="#27ae60";
  ctx.fillRect(0,canvas.height-60,canvas.width,80);
}

// ---- DRAGON ----
function drawDragon(){
  const grad=ctx.createLinearGradient(dragon.x-40,dragon.y-40,dragon.x+40,dragon.y+40);
  grad.addColorStop(0,"#e74c3c");
  grad.addColorStop(1,"#f39c12");

  // body
  ctx.fillStyle=grad;
  ctx.beginPath();
  ctx.ellipse(dragon.x,dragon.y,dragon.radius,dragon.radius*0.7,0,0,Math.PI*2);
  ctx.fill();

  // tail
  ctx.strokeStyle="#f39c12";
  ctx.lineWidth=10;
  ctx.beginPath();
  let tailWiggle=Math.sin(Date.now()/150)*10;
  ctx.moveTo(dragon.x-dragon.radius*1.5, dragon.y+tailWiggle);
  ctx.lineTo(dragon.x-dragon.radius*3, dragon.y+tailWiggle*0.5);
  ctx.stroke();

  // head
  ctx.beginPath();
  ctx.arc(dragon.x+dragon.radius*0.9,dragon.y-8,25,0,Math.PI*2);
  ctx.fillStyle=grad;
  ctx.fill();

  // horns
  ctx.fillStyle="#f1c40f";
  ctx.beginPath();
  ctx.moveTo(dragon.x+dragon.radius*0.8,dragon.y-28);
  ctx.lineTo(dragon.x+dragon.radius*1.1,dragon.y-48);
  ctx.lineTo(dragon.x+dragon.radius*1.3,dragon.y-28);
  ctx.closePath();
  ctx.fill();

  // wing
  ctx.save();
  ctx.translate(dragon.x,dragon.y);
  let wingAngle=Math.sin(Date.now()/180)*0.4;
  ctx.rotate(wingAngle);
  ctx.fillStyle="#f1c40f";
  ctx.beginPath();
  ctx.moveTo(0,0);
  ctx.quadraticCurveTo(-80,-50,-120,0);
  ctx.quadraticCurveTo(-80,50,0,0);
  ctx.fill();
  ctx.restore();

  // eye
  ctx.fillStyle="#fff";
  ctx.beginPath();
  ctx.arc(dragon.x+dragon.radius,dragon.y-12,8,0,Math.PI*2);
  ctx.fill();
  ctx.fillStyle="#000";
  ctx.beginPath();
  ctx.arc(dragon.x+dragon.radius,dragon.y-12,3,0,Math.PI*2);
  ctx.fill();

  // snout
  ctx.fillStyle="#c0392b";
  ctx.beginPath();
  ctx.ellipse(dragon.x+dragon.radius*1.25,dragon.y-6,10,6,0,0,Math.PI*2);
  ctx.fill();
}

// ---- ROCKS ----
function drawRocks(){
  rocks.forEach(r=>{
    if(r.active){
      ctx.fillStyle=r.color;
      ctx.beginPath();
      ctx.ellipse(r.x,r.y,r.radius,r.radius*0.8,0,0,Math.PI*2);
      ctx.fill();
      ctx.font="bold 18px Comic Sans MS";
      ctx.fillStyle="white";
      ctx.textAlign="center";
      ctx.fillText(r.points,r.x,r.y+6);
    }
    r.x-=1.2;
    if(r.x<-r.radius){
      r.x=canvas.width+Math.random()*canvas.width*0.5;
      r.y=canvas.height*(0.3+Math.random()*0.4);
      r.active=true;
    }
  });
}

// ---- BUBBLES ----
function drawBubbles(){
  bubbles.forEach(b=>{
    if(!b.active) return;
    let grad=ctx.createRadialGradient(b.x,b.y,10,b.x,b.y,b.radius);
    grad.addColorStop(0,"rgba(255,230,230,0.9)");
    grad.addColorStop(1,b.color);
    ctx.fillStyle=grad;
    ctx.beginPath();
    ctx.arc(b.x,b.y,b.radius,0,Math.PI*2);
    ctx.fill();
    ctx.font="bold 18px Comic Sans MS";
    ctx.fillStyle="#fff";
    ctx.textAlign="center";
    ctx.fillText("+100",b.x,b.y+6);
    b.x-=0.8;
    if(b.x<-b.radius){
      b.x=canvas.width+Math.random()*canvas.width*0.5;
      b.y=100+Math.random()*(canvas.height-200);
      b.active=true;
    }
  });
}

// ---- COLLISIONS ----
function checkCollisions() {
  rocks.forEach(r => {
    if (!r.active) return;
    let dx = dragon.x - r.x, dy = dragon.y - r.y;
    let dist = Math.sqrt(dx * dx + dy * dy);
    if (dist < dragon.radius + r.radius * 0.7) {
      r.active = false;
      score += r.points;
      scoreBoard.textContent = `Score: ${score}`;
      createExplosion(r.x, r.y, r.color);

      // ‚úÖ When player reaches win score, trigger proper sequence
      if (score >= WIN_SCORE && !gameOver) {
        levelCompleteSequence();
      }

      // Respawn the rock after a short delay
      setTimeout(() => {
        r.x = canvas.width + Math.random() * canvas.width * 0.5;
        r.y = canvas.height * (0.3 + Math.random() * 0.4);
        r.active = true;
      }, 2000);
    }
  });

  bubbles.forEach(b => {
    if (!b.active) return;
    let dx = dragon.x - b.x, dy = dragon.y - b.y;
    let dist = Math.sqrt(dx * dx + dy * dy);
    if (dist < dragon.radius + b.radius * 0.8) {
      b.active = false;
      score += b.points;
      scoreBoard.textContent = `Score: ${score}`;
      createExplosion(b.x, b.y, "#ff7675");

      // ‚úÖ Trigger win sequence when reaching score goal
      if (score >= WIN_SCORE && !gameOver) {
        levelCompleteSequence();
      }

      // Respawn the bubble after a short delay
      setTimeout(() => {
        b.x = canvas.width + Math.random() * canvas.width * 0.5;
        b.y = 100 + Math.random() * (canvas.height - 200);
        b.active = true;
      }, 4000);
    }
  });
}

// ---- UPDATE ----
function update(){
  if(gameOver) return;
  dragon.velocity+=dragon.gravity;
  dragon.y+=dragon.velocity;
  if(dragon.y>canvas.height-60-dragon.radius){
    dragon.y=canvas.height-60-dragon.radius;
    dragon.velocity=0;
  }
  if(dragon.y<dragon.radius){
    dragon.y=dragon.radius;
    dragon.velocity=0;
  }
}

// ---- GAME LOOP ----
function gameLoop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawSky(); drawClouds(); drawRocks(); drawBubbles(); drawGround();
  drawDragon(); drawParticles(); checkCollisions(); update();
  if(!gameOver) requestAnimationFrame(gameLoop);
}
gameLoop();

// ---- CONTROLS ----
function flap(){
  if(gameOver) return;
  dragon.velocity = dragon.flapStrength;
  createFire();  // üí• breathe big fire
}
window.addEventListener("keydown", e=>{ if(e.code==="Space") flap(); });
window.addEventListener("touchstart", flap);

// ---- BACKGROUND MUSIC SETUP ----
const bgMusic = document.getElementById("bgMusic");

// ‚úÖ Added: define currentLevel so banner logic works
let currentLevel = 1;

function startMusicOnce() {
  bgMusic.volume = 0.6; // Volume range: 0.0‚Äì1.0
  bgMusic.play()
    .then(() => console.log("Music started üéµ"))
    .catch(err => console.log("Autoplay prevented or file issue:", err));

  // Remove listeners once started, so this only runs once
  window.removeEventListener("keydown", startMusicOnce);
  window.removeEventListener("touchstart", startMusicOnce);
}

// ‚úÖ Start music only after first key or touch
window.addEventListener("keydown", startMusicOnce);
window.addEventListener("touchstart", startMusicOnce);

// ---- üèÜ LEVEL COMPLETE SEQUENCE ----
function levelCompleteSequence() {
  // Stop gameplay and music
  gameOver = true;

  // ‚úÖ Fully stop background music
  if (bgMusic && !bgMusic.paused) {
    console.log("Stopping music...");
    bgMusic.pause();
    bgMusic.currentTime = 0;
  }

  // Step‚ÄØ1: show ‚ÄúYOU‚ÄØWIN‚Äù banner immediately
  winOverlay.style.display = "block";
  winOverlay.innerHTML = `<div style="font-size:48px;">üéâ YOU‚ÄØWIN! üéâ</div>`;

  // Step‚ÄØ2: after‚ÄØ2‚ÄØseconds, show ‚ÄúNext‚ÄØLevel‚Äù‚ÄØprompt‚ÄØ+‚ÄØbutton
  setTimeout(() => {
    winOverlay.innerHTML = `
      <div style="font-size:36px; margin-bottom:10px;">
        Ready‚ÄØfor‚ÄØLevel‚ÄØ2‚ÄØ?
      </div>
      <div style="font-size:22px; color:#3498db; margin-bottom:20px;">
        Click‚ÄØbelow‚ÄØto‚ÄØstart‚ÄØthe‚ÄØnext‚ÄØadventure!
      </div>
      <button id="nextLevelBtn"
        style="
          font-size:26px;
          padding:12px‚ÄØ24px;
          background:#2ecc71;
          border:none;
          border-radius:10px;
          color:white;
          cursor:pointer;
          transition:transform‚ÄØ0.2s,‚ÄØbackground‚ÄØ0.2s;
        "
        onmouseover="this.style.transform='scale(1.05)';this.style.background='#27ae60';"
        onmouseout="this.style.transform='scale(1)';this.style.background='#2ecc71';">
        ‚ñ∂Ô∏è‚ÄØNEXT‚ÄØLEVEL
      </button>
    `;

    const btn = document.getElementById("nextLevelBtn");
    if (btn) btn.addEventListener("click", nextLevel);
  }, 2000);
} //‚ÄØ<-- closes‚ÄØlevelCompleteSequence()


// ---- üöÄ‚ÄØADVANCE TO‚ÄØNEXT‚ÄØLEVEL ----
function nextLevel() {
  // simple redirect from‚ÄØLevel‚ÄØ1‚ÄØ‚Üí‚ÄØLevel‚ÄØ2
  console.log("Advancing‚ÄØto‚ÄØLevel‚ÄØ2...");
  window.location.href = "dragon_flyl2.html";
}
</script>
</body>
</html>
