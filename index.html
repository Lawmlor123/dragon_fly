<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Little Dragon Flyer ğŸ²ğŸ”¥</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: linear-gradient(to bottom, #87ceeb, #dff9fb);
  }
  canvas { display: block; }
  #overlay, #scoreBoard, #winOverlay {
    position: absolute;
    font-family: 'Comic Sans MS', cursive;<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Little Dragon Flyer ğŸ‰ğŸ”¥ - LevelÂ 3: StormÂ Flight</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: linear-gradient(to bottom, #0a0a24, #1a1a40);
    font-family: "Comic Sans MS", cursive;
    color: #fff;
  }
  canvas { display: block; }

  #overlay, #scoreBoard, #winOverlay {
    position: absolute;
    z-index: 10;
    font-family: "Comic Sans MS", cursive;
  }
  #overlay {
    top: 10px;
    left: 10px;
    font-size: 20px;
    background: rgba(0,0,0,0.5);
    padding: 6px 12px;
    border-radius: 8px;
    color: #ccc;
  }
  #scoreBoard {
    top: 10px;
    right: 10px;
    font-size: 24px;
    color: #fff;
    background: rgba(0, 0, 0, 0.4);
    padding: 6px 14px;
    border-radius: 8px;
  }
  #winOverlay {
    display: none;
    top: 40%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 60px;
    background: rgba(255,255,255,0.1);
    color: #00ffff;
    padding: 40px 60px;
    border-radius: 20px;
  }
</style>
</head>
<body>
<div id="overlay">âš¡Â FlyÂ &Â BreatheÂ FireÂ toÂ SurviveÂ theÂ Storm!</div>
<div id="scoreBoard">Score:Â 0</div>
<div id="winOverlay"></div>
<canvas id="gameCanvas"></canvas>

<audio id="bgMusic" src="Music/Storm.mp3" loop preload="auto"></audio>
<!-- OptionalÂ sound for lightning cue:
<audio id="thunder" src="Music/ThunderWarning.mp3" preload="auto"></audio> -->

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
function resizeCanvas(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

// ğŸ‰Â Dragon setup
const dragon = {
  x: canvas.width * 0.2,
  y: canvas.height / 2,
  radius: 40,
  velocity: 0,
  gravity: 0.3,
  flapStrength: -6
};

// ğŸŒ©ï¸Â Lightning (harmless, golden, appears in front)
let lightnings=[];
function spawnLightning(){
  const offset = dragon.radius * 2 + 120; // strike ahead of nose
  const x = dragon.x + offset;
  lightnings.push({
    x, y:-200, segments:[],
    speed:10,
    warning:40,
    active:true,
    warnFlash:true
  });
  flashScreen(0.05);
}
spawnLightning();

// ğŸ’¨ White screen flash
function flashScreen(alpha=0.2){
  ctx.fillStyle=`rgba(255,255,255,${alpha})`;
  ctx.fillRect(0,0,canvas.width,canvas.height);
}

// ğŸ«§Â Bubbles (5â€¯colorsâ€¯=â€¯10â€“100Â points) â€” double count
let bubbles=[];
function spawnBubble(){
  const y = 100 + Math.random()*(canvas.height-200);
  const roll = Math.random();
  let color, points;
  if(roll < 0.5){ color="rgba(135,206,235,0.9)"; points=10; }       // Blue
  else if(roll < 0.7){ color="rgba(102,255,102,0.9)"; points=20; }  // Green
  else if(roll < 0.85){ color="rgba(255,105,180,0.9)"; points=25; } // Pink
  else if(roll < 0.95){ color="rgba(255,215,0,0.9)"; points=50; }   // Gold
  else { color="rgba(186,85,211,0.9)"; points=100; }                // Purple
  const radius = 20 + Math.random()*25;
  bubbles.push({x:canvas.width+100,y,radius,color,points,active:true});
}
setInterval(spawnBubble, 900);
setInterval(spawnBubble, 1300);

// ğŸ”¥Â Fire particles (fire breath)
let particles=[];
function createFire(){
  const sx = dragon.x + dragon.radius*1.4;
  const sy = dragon.y - 6;
  const colors=["#ff3300","#ff9900","#ffff66","#ff6600"];
  for(let i=0;i<35;i++){
    particles.push({
      x:sx,
      y:sy,
      radius:6+Math.random()*10,
      color:colors[Math.floor(Math.random()*colors.length)],
      alpha:1,
      velocityX:6+Math.random()*4,
      velocityY:(Math.random()-0.5)*6
    });
  }
}
function drawParticles(){
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i];
    ctx.globalAlpha=p.alpha;
    ctx.fillStyle=p.color;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.radius,0,Math.PI*2);
    ctx.fill();
    p.x+=p.velocityX;
    p.y+=p.velocityY;
    p.alpha-=0.035;
    p.radius*=0.96;
    if(p.alpha<=0)particles.splice(i,1);
  }
  ctx.globalAlpha=1;
}

// âš™ï¸Â Game state
let score=0;
let gameOver=false;
const WIN_SCORE=1000;
const bgMusic=document.getElementById("bgMusic");

// â˜ï¸Â CloudsÂ +Â HillsÂ (background)
let clouds=[];
for(let i=0;i<6;i++){
  clouds.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height*0.4,size:100+Math.random()*100});
}
function drawClouds(){
  ctx.fillStyle="rgba(255,255,255,0.3)";
  clouds.forEach(c=>{
    ctx.beginPath();
    ctx.ellipse(c.x,c.y,c.size,c.size*0.6,0,0,Math.PI*2);
    ctx.fill();
    c.x-=0.6;
    if(c.x<-c.size){c.x=canvas.width+Math.random()*canvas.width*0.5;}
  });
}
let hillOffset=0;
function drawHills(){
  ctx.fillStyle="#0a2f1d";
  const baseY=canvas.height-50,amp=60,wave=250;
  ctx.beginPath();
  ctx.moveTo(0,baseY-Math.sin(0)*amp);
  for(let x=0;x<=canvas.width;x++){
    const y=baseY-Math.sin((x+hillOffset)/wave)*amp;
    ctx.lineTo(x,y);
  }
  ctx.lineTo(canvas.width,canvas.height);
  ctx.lineTo(0,canvas.height);
  ctx.closePath();
  ctx.fill();
  hillOffset+=2;
}

// ğŸ‰Â DrawÂ Dragon
function drawDragon(){
  const grad=ctx.createLinearGradient(dragon.x-40,dragon.y-40,dragon.x+40,dragon.y+40);
  grad.addColorStop(0,"#e74c3c");
  grad.addColorStop(1,"#f39c12");
  ctx.fillStyle=grad;
  ctx.beginPath();
  ctx.ellipse(dragon.x,dragon.y,dragon.radius,dragon.radius*0.7,0,0,Math.PI*2);
  ctx.fill();

  ctx.strokeStyle="#f39c12";
  ctx.lineWidth=10;
  ctx.beginPath();
  const tWiggle=Math.sin(Date.now()/150)*10;
  ctx.moveTo(dragon.x-dragon.radius*1.5,dragon.y+tWiggle);
  ctx.lineTo(dragon.x-dragon.radius*3,dragon.y+tWiggle*0.5);
  ctx.stroke();

  ctx.beginPath();
  ctx.arc(dragon.x+dragon.radius*0.9,dragon.y-8,25,0,Math.PI*2);
  ctx.fillStyle=grad;ctx.fill();

  ctx.save();
  ctx.translate(dragon.x,dragon.y);
  const wingAngle=Math.sin(Date.now()/180)*0.4;
  ctx.rotate(wingAngle);
  ctx.fillStyle="#f1c40f";
  ctx.beginPath();
  ctx.moveTo(0,0);
  ctx.quadraticCurveTo(-80,-50,-120,0);
  ctx.quadraticCurveTo(-80,50,0,0);
  ctx.fill();
  ctx.restore();

  ctx.fillStyle="#fff";
  ctx.beginPath();
  ctx.arc(dragon.x+dragon.radius,dragon.y-12,8,0,Math.PI*2);
  ctx.fill();
  ctx.fillStyle="#000";
  ctx.beginPath();
  ctx.arc(dragon.x+dragon.radius,dragon.y-12,3,0,Math.PI*2);
  ctx.fill();
}

// âš¡Â Draw lightning (darker gold color)
function drawLightnings(){
  lightnings.forEach(l=>{
    if(l.warnFlash && l.warning>0){
      const beamGrad=ctx.createLinearGradient(l.x-15,0,l.x+15,canvas.height);
      beamGrad.addColorStop(0,"rgba(255,200,0,0)");
      beamGrad.addColorStop(0.5,"rgba(255,180,0,0.35)");
      beamGrad.addColorStop(1,"rgba(255,200,0,0)");
      ctx.fillStyle=beamGrad;
      ctx.fillRect(l.x-20,0,40,canvas.height);
      l.warning--;
      if(l.warning<=0){l.warnFlash=false;l.warning=0;}
      return;
    }

    if(l.segments.length===0){
      let pts=6+Math.floor(Math.random()*4);
      let sx=l.x+Math.random()*10-5, sy=0;
      l.segments.push({x:sx,y:sy});
      for(let i=1;i<pts;i++){
        sx+=Math.random()*60-30;
        sy+=40+Math.random()*10;
        l.segments.push({x:sx,y:sy});
      }
    }
    l.segments.forEach(pt=>pt.y+=l.speed);

    ctx.lineWidth=6;
    ctx.strokeStyle="rgba(255,200,0,0.25)";
    ctx.beginPath();
    ctx.moveTo(l.segments[0].x,l.segments[0].y);
    for(let i=1;i<l.segments.length;i++) ctx.lineTo(l.segments[i].x,l.segments[i].y);
    ctx.stroke();

    ctx.lineWidth=2;
    ctx.strokeStyle="rgba(255,220,0,0.9)";
    ctx.beginPath();
    ctx.moveTo(l.segments[0].x,l.segments[0].y);
    for(let i=1;i<l.segments.length;i++) ctx.lineTo(l.segments[i].x,l.segments[i].y);
    ctx.stroke();

    const tip=l.segments[l.segments.length-1];
    const grad=ctx.createRadialGradient(tip.x,tip.y,0,tip.x,tip.y,20);
    grad.addColorStop(0,"rgba(255,210,0,0.85)");
    grad.addColorStop(1,"rgba(255,210,0,0)");
    ctx.fillStyle=grad;
    ctx.beginPath();
    ctx.arc(tip.x,tip.y,20,0,Math.PI*2);
    ctx.fill();
  });
  lightnings=lightnings.filter(l=>{
    const lastY=l.segments.length?l.segments[l.segments.length-1].y:0;
    return lastY<canvas.height+50;
  });
}

// ğŸ’¥ Explosion
function createExplosion(x,y,color){
  for(let i=0;i<25;i++){
    particles.push({
      x,y,
      radius:4+Math.random()*4,
      color,
      alpha:1,
      velocityX:(Math.random()-0.5)*6,
      velocityY:(Math.random()-0.5)*6
    });
  }
}

// ğŸ§© Collisions (bubbles only)
function checkCollisions(){
  bubbles.forEach(b=>{
    if(!b.active)return;
    const dx=dragon.x-b.x, dy=dragon.y-b.y;
    const dist=Math.sqrt(dx*dx+dy*dy);
    if(dist<dragon.radius+b.radius){
      b.active=false;
      score+=b.points;
      document.getElementById("scoreBoard").textContent=`Score: ${score}`;
      createExplosion(b.x,b.y,b.color);
    }
  });

  if(score>=WIN_SCORE && !gameOver){ levelCompleteSequence(); }
}

// ğŸ”„ Update dragon physics
function update(){
  if(gameOver)return;
  dragon.velocity+=dragon.gravity;
  dragon.y+=dragon.velocity;
  if(dragon.y>canvas.height-120){dragon.y=canvas.height-120;dragon.velocity=0;}
  if(dragon.y<dragon.radius){dragon.y=dragon.radius;dragon.velocity=0;}
}

// ğŸ® Game Loop
function gameLoop(){
  if(gameOver)return;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawClouds();
  drawHills();

  if(Math.random()<0.004) flashScreen(0.15);
  if(Math.random()<0.005) spawnLightning();
  drawLightnings();

  bubbles.forEach(b=>{
    if(!b.active)return;
    const grad=ctx.createRadialGradient(b.x,b.y,8,b.x,b.y,b.radius);
    grad.addColorStop(0,"rgba(255,255,255,0.9)");
    grad.addColorStop(1,b.color);
    ctx.fillStyle=grad;
    ctx.beginPath();
    ctx.arc(b.x,b.y,b.radius,0,Math.PI*2);
    ctx.fill();

    // ğŸ–¤ black bubble labels for readability
    ctx.fillStyle="#000";
    ctx.font="bold 18px Comic Sans MS";
    ctx.textAlign="center";
    ctx.fillText("+"+b.points,b.x,b.y+6);

    b.x-=1.4;
    if(b.x<-b.radius){
      b.x=canvas.width+Math.random()*canvas.width*0.5;
      b.y=100+Math.random()*(canvas.height-200);
      b.active=true;
    }
  });

  drawDragon();
  drawParticles();
  checkCollisions();
  update();
  requestAnimationFrame(gameLoop);
}
gameLoop();

// ğŸ•¹ Controls
function flap(){ if(gameOver)return; dragon.velocity=dragon.flapStrength; createFire(); }
window.addEventListener("keydown",e=>{if(e.code==="Space")flap();});
window.addEventListener("touchstart",flap);

// ğŸµ Music
function startMusicOnce(){
  bgMusic.volume=0.6; bgMusic.play().catch(()=>{});
  window.removeEventListener("keydown",startMusicOnce);
  window.removeEventListener("touchstart",startMusicOnce);
}
window.addEventListener("keydown",startMusicOnce);
window.addEventListener("touchstart",startMusicOnce);

// ğŸ Win overlay
function levelCompleteSequence(){
  gameOver=true;
  bgMusic.pause(); bgMusic.currentTime=0;
  const w=document.getElementById("winOverlay");
  w.style.display="block";
  w.innerHTML=`
    <div style="font-size:48px;color:#2ecc71;">ğŸŒˆÂ LEVELÂ 3Â COMPLETE!Â ğŸŒˆ</div>
    <div style="font-size:22px;">FinalÂ Score:Â ${score}</div>
    <button id="nextBtn" style="font-size:26px;padding:12pxÂ 24px;background:#2ecc71;border:none;border-radius:10px;color:white;margin-top:20px;cursor:pointer;">â¡ï¸Â NEXTÂ LEVEL</button>`;
  document.getElementById("nextBtn").onclick=()=>window.location.href="dragon_flyl4.html";
}
</script>
</body>
</html>
    z-index: 10;<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Little Dragon Flyer ğŸ²ğŸ”¥ - Level 2</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: linear-gradient(to bottom, #74b9ff, #a29bfe);
  }
  canvas { display: block; }
  #overlay, #scoreBoard, #winOverlay {
    position: absolute;
    font-family: 'Comic Sans MS', cursive;
    z-index: 10;
  }
  #overlay {
    top: 10px;
    left: 10px;
    font-size: 22px;
    color: #333;
    background: rgba(255,255,255,0.6);
    padding: 6px 12px;
    border-radius: 8px;
  }
  #scoreBoard {
    top: 10px;
    right: 10px;
    font-size: 24px;
    color: #222;
    background: rgba(255,255,255,0.6);
    padding: 6px 14px;
    border-radius: 8px;
  }
  #winOverlay {
    display: none;
    top: 40%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 60px;
    color: #e74c3c;
    background: rgba(255,255,255,0.85);
    padding: 40px 60px;
    border-radius: 20px;
    animation: pop 1s ease infinite alternate;
  }
  @keyframes pop {
    0% { transform: translate(-50%, -50%) scale(1); }
    100% { transform: translate(-50%, -50%) scale(1.05); }
  }
</style>
</head>
<body>
<div id="overlay">ğŸ‰ Tap or Press Space to keep flying uphill!</div>
<div id="scoreBoard">Score: 0</div>
<div id="winOverlay">ğŸ‰ LEVEL 2 COMPLETE! ğŸ‰</div>
<canvas id="gameCanvas"></canvas>

<audio id="bgMusic" src="Music/Chase.mp3" loop preload="auto"></audio>

<script>
const canvas=document.getElementById("gameCanvas");
const ctx=canvas.getContext("2d");
function resizeCanvas(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;}
window.addEventListener("resize",resizeCanvas);
resizeCanvas();

// ğŸ‰ DRAGON
let dragon={x:canvas.width*0.2,y:canvas.height/2,radius:40,velocity:0,gravity:0.3,flapStrength:-6};

// â˜ï¸ CLOUDS
let clouds=[];
for(let i=0;i<5;i++){
  clouds.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height*0.5,size:60+Math.random()*80});
}

// ğŸª¨ ROCKS
let rocks=[];
const rockColors=["#e74c3c","#3498db","#e74c3c","#3498db","#e74c3c"];
const rockPoints=[10,20,30,15,25];
for(let i=0;i<6;i++){
  rocks.push({
    x:canvas.width+i*(canvas.width/2),
    y:canvas.height*(0.3+Math.random()*0.4),
    radius:45,
    color:rockColors[i%rockColors.length],
    active:true,
    points:rockPoints[i%rockPoints.length]
  });
}

// ğŸ° SMALL TOWERS (barriers)
let towers = [];
for (let i = 0; i < 1; i++) {  // only 1 tower at a time
  towers.push({
    x: canvas.width + i * (canvas.width * 1.8), // extra spacing
    width: 70,
    height: 100,
    color: "#8e44ad",
    active: true
  });
}

// ğŸ’ BUBBLES
let bubbles=[];
for(let i=0;i<3;i++){
  bubbles.push({
    x:canvas.width+Math.random()*canvas.width,
    y:100+Math.random()*(canvas.height-200),
    radius:35,
    color:"rgba(150,0,0,0.85)",
    active:true,
    points:100
  });
}

function drawTowers() {
  const baseY = canvas.height - 60;
  towers.forEach(t => {
    const topY = baseY - t.height;

    // stone gradient body
    const grad = ctx.createLinearGradient(t.x, topY, t.x + t.width, topY + t.height);
    grad.addColorStop(0, "#7d3c98");
    grad.addColorStop(0.5, "#a569bd");
    grad.addColorStop(1, "#6c3483");
    ctx.fillStyle = grad;
    ctx.fillRect(t.x, topY, t.width, t.height);

    // brick engraving lines
    ctx.strokeStyle = "rgba(255,255,255,0.25)";
    for (let y = topY + 10; y < topY + t.height; y += 10) {
      ctx.beginPath();
      ctx.moveTo(t.x + 3, y);
      ctx.lineTo(t.x + t.width - 3, y);
      ctx.stroke();
    }
    for (let x = t.x + 12; x < t.x + t.width; x += 20) {
      ctx.beginPath();
      ctx.moveTo(x, topY);
      ctx.lineTo(x, topY + t.height);
      ctx.stroke();
    }

    // roof triangle
    ctx.fillStyle = "#5b2c6f";
    ctx.beginPath();
    ctx.moveTo(t.x - 5, topY);
    ctx.lineTo(t.x + t.width / 2, topY - 20);
    ctx.lineTo(t.x + t.width + 5, topY);
    ctx.closePath();
    ctx.fill();
    ctx.strokeStyle = "#2e005f";
    ctx.stroke();

    // flag
    ctx.fillStyle = "#e74c3c";
    ctx.beginPath();
    ctx.moveTo(t.x + t.width / 2, topY - 20);
    ctx.lineTo(t.x + t.width / 2 + 18, topY - 10);
    ctx.lineTo(t.x + t.width / 2, topY);
    ctx.closePath();
    ctx.fill();

    // movement & respawn spacing
    t.x -= 2;
    if (t.x + t.width < 0) {
      t.x = canvas.width + Math.random() * (canvas.width * 1.8);
      t.height = 80 + Math.random() * 40;
      t.active = true;
    }
  });
}

// ğŸ”¥ PARTICLES
let particles=[];
function createExplosion(x,y,color){
  for(let i=0;i<25;i++){
    particles.push({
      x,y,
      radius:4+Math.random()*4,
      color,
      alpha:1,
      velocityX:(Math.random()-0.5)*6,
      velocityY:(Math.random()-0.5)*6,
      isFire:false
    });
  }
}
function createFire(){
  const sx=dragon.x+dragon.radius*1.4;
  const sy=dragon.y-6;
  const colors=["#ff3300","#ff9900","#ffff66","#ff6600"];
  for(let i=0;i<40;i++){
    particles.push({
      x:sx,
      y:sy,
      radius:6+Math.random()*10,
      color:colors[Math.floor(Math.random()*colors.length)],
      alpha:1,
      velocityX:6+Math.random()*4,
      velocityY:(Math.random()-0.5)*6,
      isFire:true
    });
  }
}
function drawParticles(){
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i];
    ctx.globalAlpha=p.alpha;
    ctx.fillStyle=p.color;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.radius,0,Math.PI*2);
    ctx.fill();
    if(p.isFire){
      p.x+=p.velocityX;
      p.y+=p.velocityY;
      p.alpha-=0.035;
      p.radius*=0.96;
    }else{
      p.x+=p.velocityX*0.6;
      p.y+=p.velocityY*0.6;
      p.alpha-=0.02;
    }
    if(p.alpha<=0.05)particles.splice(i,1);
  }
  ctx.globalAlpha=1;
}
// âš™ï¸ SCORE & GAME STATE
let score=0;
const WIN_SCORE=600;
let gameOver=false;

// ğŸ¨ BACKGROUND
function drawSky(){
  const grad=ctx.createLinearGradient(0,0,0,canvas.height);
  grad.addColorStop(0,"#74b9ff");
  grad.addColorStop(1,"#a29bfe");
  ctx.fillStyle=grad;
  ctx.fillRect(0,0,canvas.width,canvas.height);
}

function drawClouds(){
  ctx.fillStyle="rgba(255,255,255,0.85)";
  clouds.forEach(c=>{
    ctx.beginPath();
    ctx.ellipse(c.x,c.y,c.size,c.size*0.6,0,0,Math.PI*2);
    ctx.fill();
    c.x-=0.4;
    if(c.x<-c.size){
      c.x=canvas.width+Math.random()*canvas.width*0.5;
    }
  });
}

// ğŸŒ„ HILL LANDSCAPE
let hillOffset=0;
function drawHill(){
  ctx.fillStyle="#27ae60";
  ctx.beginPath();
  const baseY=canvas.height-60;
  const amplitude=80;
  const wavelength=300;
  ctx.moveTo(0, baseY - Math.sin(0)*amplitude);
  for(let x=0;x<=canvas.width;x++){
    let y=baseY - Math.sin((x+hillOffset)/wavelength)*amplitude;
    ctx.lineTo(x,y);
  }
  ctx.lineTo(canvas.width,canvas.height);
  ctx.lineTo(0,canvas.height);
  ctx.closePath();
  ctx.fill();
  hillOffset+=2;
}

// ğŸ‰ DRAGON DRAW
function drawDragon(){
  const grad=ctx.createLinearGradient(dragon.x-40,dragon.y-40,dragon.x+40,dragon.y+40);
  grad.addColorStop(0,"#e74c3c");
  grad.addColorStop(1,"#f39c12");
  ctx.fillStyle=grad;

  ctx.beginPath();
  ctx.ellipse(dragon.x,dragon.y,dragon.radius,dragon.radius*0.7,0,0,Math.PI*2);
  ctx.fill();

  ctx.strokeStyle="#f39c12";
  ctx.lineWidth=10;
  ctx.beginPath();
  let tailWiggle=Math.sin(Date.now()/150)*10;
  ctx.moveTo(dragon.x-dragon.radius*1.5,dragon.y+tailWiggle);
  ctx.lineTo(dragon.x-dragon.radius*3,dragon.y+tailWiggle*0.5);
  ctx.stroke();

  ctx.beginPath();
  ctx.arc(dragon.x+dragon.radius*0.9,dragon.y-8,25,0,Math.PI*2);
  ctx.fillStyle=grad;
  ctx.fill();

  ctx.fillStyle="#f1c40f";
  ctx.beginPath();
  ctx.moveTo(dragon.x+dragon.radius*0.8,dragon.y-28);
  ctx.lineTo(dragon.x+dragon.radius*1.1,dragon.y-48);
  ctx.lineTo(dragon.x+dragon.radius*1.3,dragon.y-28);
  ctx.closePath();
  ctx.fill();

  ctx.save();
  ctx.translate(dragon.x,dragon.y);
  let wingAngle=Math.sin(Date.now()/180)*0.4;
  ctx.rotate(wingAngle);
  ctx.fillStyle="#f1c40f";
  ctx.beginPath();
  ctx.moveTo(0,0);
  ctx.quadraticCurveTo(-80,-50,-120,0);
  ctx.quadraticCurveTo(-80,50,0,0);
  ctx.fill();
  ctx.restore();

  ctx.fillStyle="#fff";
  ctx.beginPath();
  ctx.arc(dragon.x+dragon.radius,dragon.y-12,8,0,Math.PI*2);
  ctx.fill();

  ctx.fillStyle="#000";
  ctx.beginPath();
  ctx.arc(dragon.x+dragon.radius,dragon.y-12,3,0,Math.PI*2);
  ctx.fill();

  ctx.fillStyle="#c0392b";
  ctx.beginPath();
  ctx.ellipse(dragon.x+dragon.radius*1.25,dragon.y-6,10,6,0,0,Math.PI*2);
  ctx.fill();
}

// ğŸª¨ ROCKS
function drawRocks(){
  rocks.forEach(r=>{
    if(r.active){
      ctx.fillStyle=r.color;
      ctx.beginPath();
      ctx.ellipse(r.x,r.y,r.radius,r.radius*0.8,0,0,Math.PI*2);
      ctx.fill();
      ctx.fillStyle="white";
      ctx.font="bold 18px Comic Sans MS";
      ctx.textAlign="center";
      ctx.fillText(r.points,r.x,r.y+6);
    }
    r.x-=1.6;
    if(r.x<-r.radius){
      r.x=canvas.width+Math.random()*canvas.width*0.5;
      r.y=canvas.height*(0.3+Math.random()*0.4);
      r.active=true;
    }
  });
}

// ğŸ’ BUBBLES
function drawBubbles(){
  bubbles.forEach(b=>{
    if(!b.active) return;
    let grad=ctx.createRadialGradient(b.x,b.y,10,b.x,b.y,b.radius);
    grad.addColorStop(0,"rgba(255,230,230,0.9)");
    grad.addColorStop(1,b.color);
    ctx.fillStyle=grad;
    ctx.beginPath();
    ctx.arc(b.x,b.y,b.radius,0,Math.PI*2);
    ctx.fill();

    ctx.fillStyle="#fff";
    ctx.font="bold 18px Comic Sans MS";
    ctx.textAlign="center";
    ctx.fillText("+100",b.x,b.y+6);

    b.x-=1.1;
    if(b.x<-b.radius){
      b.x=canvas.width+Math.random()*canvas.width*0.5;
      b.y=100+Math.random()*(canvas.height-200);
      b.active=true;
    }
  });
}

// ğŸ§© COLLISIONS
function checkCollisions(){
  // rock collisions
  rocks.forEach(r=>{
    if(!r.active) return;
    let dx=dragon.x-r.x, dy=dragon.y-r.y;
    let dist=Math.sqrt(dx*dx+dy*dy);
    if(dist<dragon.radius+r.radius*0.7){
      r.active=false;
      score+=r.points;
      document.getElementById("scoreBoard").textContent=`Score: ${score}`;
      createExplosion(r.x,r.y,r.color);
    }
  });

  // bubble collisions
  bubbles.forEach(b=>{
    if(!b.active) return;
    let dx=dragon.x-b.x, dy=dragon.y-b.y;
    let dist=Math.sqrt(dx*dx+dy*dy);
    if(dist<dragon.radius+b.radius*0.8){
      b.active=false;
      score+=b.points;
      document.getElementById("scoreBoard").textContent=`Score: ${score}`;
      createExplosion(b.x,b.y,"#ff7675");
    }
  });

  // ğŸ’¥ tower collisions
  const baseY=canvas.height-60;
  towers.forEach(t=>{
    const towerTop=baseY-t.height;
    if(dragon.x+dragon.radius>t.x && dragon.x-dragon.radius<t.x+t.width){
      if(dragon.y+dragon.radius>towerTop){
        createExplosion(dragon.x,dragon.y,"#ff0000");
        gameOver=true;
        bgMusic.pause(); bgMusic.currentTime=0;
        const winOverlay=document.getElementById("winOverlay");
        winOverlay.style.display="block";
        winOverlay.innerHTML=`
          <div style="font-size:48px; color:#c0392b;">ğŸ’¥ You hit the tower!</div>
          <div style="font-size:22px; color:#3498db; margin-top:10px;">Try again?</div>
          <button id="retryBtn" style="font-size:26px;padding:12px 24px;background:#e74c3c;border:none;border-radius:10px;color:white;margin-top:20px;cursor:pointer;">ğŸ” RESTART LEVEL</button>`;
        document.getElementById("retryBtn").addEventListener("click",()=>{window.location.href="dragon_flyl2.html";});
      }
    }
  });

  if(score>=WIN_SCORE && !gameOver){
    levelCompleteSequence();
  }
}

// ğŸ”„ UPDATE
function update(){
  if(gameOver) return;
  dragon.velocity+=dragon.gravity;
  dragon.y+=dragon.velocity;
  if(dragon.y>canvas.height-120){dragon.y=canvas.height-120;dragon.velocity=0;}
  if(dragon.y<dragon.radius){dragon.y=dragon.radius;dragon.velocity=0;}
}

// ğŸ¬ GAME LOOP
function gameLoop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawSky(); drawClouds(); drawRocks(); drawBubbles(); drawHill(); drawTowers();
  drawDragon(); drawParticles(); checkCollisions(); update();
  if(!gameOver) requestAnimationFrame(gameLoop);
}
gameLoop();

// ğŸ® CONTROLS
function flap(){
  if(gameOver) return;
  dragon.velocity=dragon.flapStrength;
  createFire();
}
window.addEventListener("keydown",e=>{if(e.code==="Space")flap();});
window.addEventListener("touchstart",flap);

// ğŸµ MUSIC
const bgMusic=document.getElementById("bgMusic");
function startMusicOnce(){
  bgMusic.volume=0.6;
  bgMusic.play().catch(()=>{});
  window.removeEventListener("keydown",startMusicOnce);
  window.removeEventListener("touchstart",startMusicOnce);
}
window.addEventListener("keydown",startMusicOnce);
window.addEventListener("touchstart",startMusicOnce);

// ğŸ LEVEL COMPLETE
function levelCompleteSequence(){
  gameOver=true;
  bgMusic.pause();
  bgMusic.currentTime=0;
  const winOverlay=document.getElementById("winOverlay");
  winOverlay.style.display="block";
  winOverlay.innerHTML=`
    <div style="font-size:48px;">ğŸ‰ LEVEL 2 COMPLETE! ğŸ‰</div>
    <div style="font-size:22px; color:#3498db; margin-top:10px;">Get ready for LevelÂ 3...</div>
    <button id="nextBtn" style="font-size:26px;padding:12px 24px;background:#2ecc71;border:none;border-radius:10px;color:white;margin-top:20px;cursor:pointer;">â¡ï¸ NEXT LEVEL</button>`;
  
  // âœ…Â Go to LevelÂ 3 instead of replaying LevelÂ 2
  document.getElementById("nextBtn").addEventListener("click",()=>{
    window.location.href="dragon_flyl3.html";
  });
}
</script>
</body>
</html>
  }
  #overlay {
    top: 10px;
    left: 10px;
    font-size: 22px;
    color: #333;
    background: rgba(255,255,255,0.5);
    padding: 6px 12px;
    border-radius: 8px;
  }
  #scoreBoard {
    top: 10px;
    right: 10px;
    font-size: 24px;
    color: #222;
    background: rgba(255,255,255,0.5);
    padding: 6px 14px;
    border-radius: 8px;
  }
  #winOverlay {
    display: none;
    top: 40%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 60px;
    color: #e74c3c;
    background: rgba(255,255,255,0.8);
    padding: 40px 60px;
    border-radius: 20px;
    animation: pop 1s ease infinite alternate;
  }
  @keyframes pop {
    0% { transform: translate(-50%, -50%) scale(1); }
    100% { transform: translate(-50%, -50%) scale(1.05); }
  }
</style>
</head>
<body>
<div id="overlay">ğŸ‰ Tap or Press Space to Fly (and breathe BIG fire!)</div>
<div id="scoreBoard">Score: 0</div>
<div id="winOverlay">ğŸ‰ YOU WIN! ğŸ‰</div>
<canvas id="gameCanvas"></canvas>

<!-- ğŸµ Background Music -->
<audio id="bgMusic" src="Music/Chase.mp3" loop preload="auto"></audio>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const scoreBoard = document.getElementById("scoreBoard");
const winOverlay = document.getElementById("winOverlay");

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

// ---- DRAGON ----
let dragon = {
  x: canvas.width * 0.2,
  y: canvas.height / 2,
  radius: 40,
  velocity: 0,
  gravity: 0.25,
  flapStrength: -6
};

// ---- BACKGROUND ELEMENTS ----
let clouds = [];
for (let i = 0; i < 5; i++) {
  clouds.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height*0.5, size: 60+Math.random()*80 });
}

let rocks = [];
const rockColors = ["#e74c3c", "#3498db", "#e74c3c", "#3498db", "#e74c3c"];
const rockHeights = [0.3, 0.45, 0.6, 0.5, 0.7];
const rockPoints = [10, 20, 30, 15, 25];
for (let i=0; i<5; i++){
  rocks.push({
    x: canvas.width + i*(canvas.width/2),
    y: canvas.height*rockHeights[i],
    radius:45,
    color:rockColors[i],
    active:true,
    points:rockPoints[i]
  });
}

// ---- RED 100 POINT BUBBLES ----
let bubbles = [];
for (let i=0; i<3; i++){
  bubbles.push({
    x:canvas.width + Math.random()*canvas.width,
    y:100 + Math.random()*(canvas.height-200),
    radius:35,
    color:"rgba(150,0,0,0.85)",
    active:true,
    points:100
  });
}

// ---- PARTICLES ----
let particles = [];
function createExplosion(x,y,color){
  for (let i=0; i<25; i++){
    particles.push({
      x,y,
      radius:4+Math.random()*4,
      color,
      alpha:1,
      velocityX:(Math.random()-0.5)*6,
      velocityY:(Math.random()-0.5)*6,
      isFire:false
    });
  }
}

// ğŸ”¥ Bigger Fire
function createFire(){
  const sx = dragon.x + dragon.radius * 1.4;
  const sy = dragon.y - 6;
  for (let i=0; i<40; i++){ // increased number
    const colorChoices = ["#ff3300", "#ff9900", "#ffff66", "#ff6600"];
    particles.push({
      x:sx,
      y:sy,
      radius:6 + Math.random()*10, // bigger flames
      color:colorChoices[Math.floor(Math.random()*colorChoices.length)],
      alpha:1,
      velocityX:6 + Math.random()*4, // spreads farther
      velocityY:(Math.random()-0.5)*6,
      isFire:true
    });
  }
}

function drawParticles(){
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i];
    ctx.globalAlpha=p.alpha;
    ctx.fillStyle=p.color;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.radius,0,Math.PI*2);
    ctx.fill();

    if(p.isFire){
      p.x+=p.velocityX;
      p.y+=p.velocityY;
      p.alpha-=0.035;
      p.radius*=0.96;
    } else {
      p.x+=p.velocityX*0.6;
      p.y+=p.velocityY*0.6;
      p.alpha-=0.02;
    }
    if(p.alpha<=0.05) particles.splice(i,1);
  }
  ctx.globalAlpha=1;
}

// ---- SCORE ----
let score=0;
const WIN_SCORE=500;
let gameOver=false;

// ---- DRAW ENVIRONMENT ----
function drawSky(){ ctx.fillStyle="#87ceeb"; ctx.fillRect(0,0,canvas.width,canvas.height); }
function drawClouds(){
  ctx.fillStyle="rgba(255,255,255,0.85)";
  clouds.forEach(c=>{
    ctx.beginPath();
    ctx.ellipse(c.x,c.y,c.size,c.size*0.6,0,0,Math.PI*2);
    ctx.fill();
    c.x-=0.3;
    if(c.x<-c.size){c.x=canvas.width+c.size; c.y=Math.random()*canvas.height*0.5;}
  });
}
function drawGround(){
  ctx.fillStyle="#27ae60";
  ctx.fillRect(0,canvas.height-60,canvas.width,80);
}

// ---- DRAGON ----
function drawDragon(){
  const grad=ctx.createLinearGradient(dragon.x-40,dragon.y-40,dragon.x+40,dragon.y+40);
  grad.addColorStop(0,"#e74c3c");
  grad.addColorStop(1,"#f39c12");

  // body
  ctx.fillStyle=grad;
  ctx.beginPath();
  ctx.ellipse(dragon.x,dragon.y,dragon.radius,dragon.radius*0.7,0,0,Math.PI*2);
  ctx.fill();

  // tail
  ctx.strokeStyle="#f39c12";
  ctx.lineWidth=10;
  ctx.beginPath();
  let tailWiggle=Math.sin(Date.now()/150)*10;
  ctx.moveTo(dragon.x-dragon.radius*1.5, dragon.y+tailWiggle);
  ctx.lineTo(dragon.x-dragon.radius*3, dragon.y+tailWiggle*0.5);
  ctx.stroke();

  // head
  ctx.beginPath();
  ctx.arc(dragon.x+dragon.radius*0.9,dragon.y-8,25,0,Math.PI*2);
  ctx.fillStyle=grad;
  ctx.fill();

  // horns
  ctx.fillStyle="#f1c40f";
  ctx.beginPath();
  ctx.moveTo(dragon.x+dragon.radius*0.8,dragon.y-28);
  ctx.lineTo(dragon.x+dragon.radius*1.1,dragon.y-48);
  ctx.lineTo(dragon.x+dragon.radius*1.3,dragon.y-28);
  ctx.closePath();
  ctx.fill();

  // wing
  ctx.save();
  ctx.translate(dragon.x,dragon.y);
  let wingAngle=Math.sin(Date.now()/180)*0.4;
  ctx.rotate(wingAngle);
  ctx.fillStyle="#f1c40f";
  ctx.beginPath();
  ctx.moveTo(0,0);
  ctx.quadraticCurveTo(-80,-50,-120,0);
  ctx.quadraticCurveTo(-80,50,0,0);
  ctx.fill();
  ctx.restore();

  // eye
  ctx.fillStyle="#fff";
  ctx.beginPath();
  ctx.arc(dragon.x+dragon.radius,dragon.y-12,8,0,Math.PI*2);
  ctx.fill();
  ctx.fillStyle="#000";
  ctx.beginPath();
  ctx.arc(dragon.x+dragon.radius,dragon.y-12,3,0,Math.PI*2);
  ctx.fill();

  // snout
  ctx.fillStyle="#c0392b";
  ctx.beginPath();
  ctx.ellipse(dragon.x+dragon.radius*1.25,dragon.y-6,10,6,0,0,Math.PI*2);
  ctx.fill();
}

// ---- ROCKS ----
function drawRocks(){
  rocks.forEach(r=>{
    if(r.active){
      ctx.fillStyle=r.color;
      ctx.beginPath();
      ctx.ellipse(r.x,r.y,r.radius,r.radius*0.8,0,0,Math.PI*2);
      ctx.fill();
      ctx.font="bold 18px Comic Sans MS";
      ctx.fillStyle="white";
      ctx.textAlign="center";
      ctx.fillText(r.points,r.x,r.y+6);
    }
    r.x-=1.2;
    if(r.x<-r.radius){
      r.x=canvas.width+Math.random()*canvas.width*0.5;
      r.y=canvas.height*(0.3+Math.random()*0.4);
      r.active=true;
    }
  });
}

// ---- BUBBLES ----
function drawBubbles(){
  bubbles.forEach(b=>{
    if(!b.active) return;
    let grad=ctx.createRadialGradient(b.x,b.y,10,b.x,b.y,b.radius);
    grad.addColorStop(0,"rgba(255,230,230,0.9)");
    grad.addColorStop(1,b.color);
    ctx.fillStyle=grad;
    ctx.beginPath();
    ctx.arc(b.x,b.y,b.radius,0,Math.PI*2);
    ctx.fill();
    ctx.font="bold 18px Comic Sans MS";
    ctx.fillStyle="#fff";
    ctx.textAlign="center";
    ctx.fillText("+100",b.x,b.y+6);
    b.x-=0.8;
    if(b.x<-b.radius){
      b.x=canvas.width+Math.random()*canvas.width*0.5;
      b.y=100+Math.random()*(canvas.height-200);
      b.active=true;
    }
  });
}

// ---- COLLISIONS ----
function checkCollisions() {
  rocks.forEach(r => {
    if (!r.active) return;
    let dx = dragon.x - r.x, dy = dragon.y - r.y;
    let dist = Math.sqrt(dx * dx + dy * dy);
    if (dist < dragon.radius + r.radius * 0.7) {
      r.active = false;
      score += r.points;
      scoreBoard.textContent = `Score: ${score}`;
      createExplosion(r.x, r.y, r.color);

      // âœ… When player reaches win score, trigger proper sequence
      if (score >= WIN_SCORE && !gameOver) {
        levelCompleteSequence();
      }

      // Respawn the rock after a short delay
      setTimeout(() => {
        r.x = canvas.width + Math.random() * canvas.width * 0.5;
        r.y = canvas.height * (0.3 + Math.random() * 0.4);
        r.active = true;
      }, 2000);
    }
  });

  bubbles.forEach(b => {
    if (!b.active) return;
    let dx = dragon.x - b.x, dy = dragon.y - b.y;
    let dist = Math.sqrt(dx * dx + dy * dy);
    if (dist < dragon.radius + b.radius * 0.8) {
      b.active = false;
      score += b.points;
      scoreBoard.textContent = `Score: ${score}`;
      createExplosion(b.x, b.y, "#ff7675");

      // âœ… Trigger win sequence when reaching score goal
      if (score >= WIN_SCORE && !gameOver) {
        levelCompleteSequence();
      }

      // Respawn the bubble after a short delay
      setTimeout(() => {
        b.x = canvas.width + Math.random() * canvas.width * 0.5;
        b.y = 100 + Math.random() * (canvas.height - 200);
        b.active = true;
      }, 4000);
    }
  });
}

// ---- UPDATE ----
function update(){
  if(gameOver) return;
  dragon.velocity+=dragon.gravity;
  dragon.y+=dragon.velocity;
  if(dragon.y>canvas.height-60-dragon.radius){
    dragon.y=canvas.height-60-dragon.radius;
    dragon.velocity=0;
  }
  if(dragon.y<dragon.radius){
    dragon.y=dragon.radius;
    dragon.velocity=0;
  }
}

// ---- GAME LOOP ----
function gameLoop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawSky(); drawClouds(); drawRocks(); drawBubbles(); drawGround();
  drawDragon(); drawParticles(); checkCollisions(); update();
  if(!gameOver) requestAnimationFrame(gameLoop);
}
gameLoop();

// ---- CONTROLS ----
function flap(){
  if(gameOver) return;
  dragon.velocity = dragon.flapStrength;
  createFire();  // ğŸ’¥ breathe big fire
}
window.addEventListener("keydown", e=>{ if(e.code==="Space") flap(); });
window.addEventListener("touchstart", flap);

// ---- BACKGROUND MUSIC SETUP ----
const bgMusic = document.getElementById("bgMusic");

// âœ… Added: define currentLevel so banner logic works
let currentLevel = 1;

function startMusicOnce() {
  bgMusic.volume = 0.6; // Volume range: 0.0â€“1.0
  bgMusic.play()
    .then(() => console.log("Music started ğŸµ"))
    .catch(err => console.log("Autoplay prevented or file issue:", err));

  // Remove listeners once started, so this only runs once
  window.removeEventListener("keydown", startMusicOnce);
  window.removeEventListener("touchstart", startMusicOnce);
}

// âœ… Start music only after first key or touch
window.addEventListener("keydown", startMusicOnce);
window.addEventListener("touchstart", startMusicOnce);

// ---- ğŸ† LEVEL COMPLETE SEQUENCE ----
function levelCompleteSequence() {
  // Stop gameplay and music
  gameOver = true;

  // âœ… Fully stop background music
  if (bgMusic && !bgMusic.paused) {
    console.log("Stopping music...");
    bgMusic.pause();
    bgMusic.currentTime = 0;
  }

  // Stepâ€¯1: show â€œYOUâ€¯WINâ€ banner immediately
  winOverlay.style.display = "block";
  winOverlay.innerHTML = `<div style="font-size:48px;">ğŸ‰ YOUâ€¯WIN! ğŸ‰</div>`;

  // Stepâ€¯2: afterâ€¯2â€¯seconds, show â€œNextâ€¯Levelâ€â€¯promptâ€¯+â€¯button
  setTimeout(() => {
    winOverlay.innerHTML = `
      <div style="font-size:36px; margin-bottom:10px;">
        Readyâ€¯forâ€¯Levelâ€¯2â€¯?
      </div>
      <div style="font-size:22px; color:#3498db; margin-bottom:20px;">
        Clickâ€¯belowâ€¯toâ€¯startâ€¯theâ€¯nextâ€¯adventure!
      </div>
      <button id="nextLevelBtn"
        style="
          font-size:26px;
          padding:12pxâ€¯24px;
          background:#2ecc71;
          border:none;
          border-radius:10px;
          color:white;
          cursor:pointer;
          transition:transformâ€¯0.2s,â€¯backgroundâ€¯0.2s;
        "
        onmouseover="this.style.transform='scale(1.05)';this.style.background='#27ae60';"
        onmouseout="this.style.transform='scale(1)';this.style.background='#2ecc71';">
        â–¶ï¸â€¯NEXTâ€¯LEVEL
      </button>
    `;

    const btn = document.getElementById("nextLevelBtn");
    if (btn) btn.addEventListener("click", nextLevel);
  }, 2000);
} //â€¯<-- closesâ€¯levelCompleteSequence()


// ---- ğŸš€â€¯ADVANCE TOâ€¯NEXTâ€¯LEVEL ----
function nextLevel() {
  // simple redirect fromâ€¯Levelâ€¯1â€¯â†’â€¯Levelâ€¯2
  console.log("Advancingâ€¯toâ€¯Levelâ€¯2...");
  window.location.href = "dragon_flyl2.html";
}
</script>
</body>
</html>
